# TianShanOS 重构分析与规划

> **项目名称**：TianShanOS（天山操作系统）
> 
> **命名寓意**：天山控制新疆南北两大盆地——北向 AGX 提供 AI 算力，南向 LPMU 提供通用计算和存储服务
> 
> **创建日期**：2026年1月15日

---

## 📋 第一部分：现有问题分析

### 1. 硬件抽象层问题 🔴 严重

| 问题编号 | 问题描述 | 影响范围 | 严重程度 |
|---------|---------|---------|---------|
| H-01 | GPIO引脚硬编码，无法适配不同硬件平台 | 全局 | 🔴 严重 |
| H-02 | 缺乏对 ESP32P4 等新平台的预留设计 | 未来扩展 | 🔴 严重 |
| H-03 | 早期组件（LED、以太网等）硬编码了绝大部分GPIO | 多个组件 | 🔴 严重 |
| H-04 | IO资源不足导致功能缺失（如风扇转速读取） | 风扇控制 | 🟡 中等 |
| H-05 | 缺乏统一的引脚分配和冲突检测机制 | 全局 | 🔴 严重 |
| H-06 | 硬件配置无法运行时动态调整 | 部署灵活性 | 🟡 中等 |

**需要思考的问题**：
- [ ] 如何设计一个真正可移植的硬件抽象层？
- [ ] 引脚配置是编译时确定还是运行时加载？
- [ ] 是否需要支持"硬件配置文件"概念？
- [ ] 如何处理不同芯片的外设差异（如 ESP32S3 和 ESP32P4 的 RMT、LEDC 差异）？
- [ ] 引脚复用和冲突检测如何实现？

#### 来自 Tom 的回答
我希望不只是能够为本项目使用，也能为其他的ESP32（主要是S3、P4等高性能SoC）项目使用
需要设计一个真正可以移植的硬件抽象层，可以通过 API 创建 GPIO、I2C、Uart、PWM 等各类接口，这些接口能够被实例化为具体的业务接口；
对于ESP32其中包含的能力 BLE 、 Wi-Fi 则可以直接调用。
根据这个特点我更希望这是一个在运行时加载的配置，而不是完全固化。能够支持硬件配置文件，是非常好的想法，这样可以方便初始化一些预定义的硬件。
处理不同芯片的外设差异，目前仅考虑 S3 和 P4，所以可以通过配置文件或者是内置一个中间层来处理。
引脚复用和冲突检测需要你来考虑，基于全部信息你可以通盘考虑。

---

### 2. 组件架构问题 🔴 严重

| 问题编号 | 问题描述 | 影响范围 | 严重程度 |
|---------|---------|---------|---------|
| A-01 | 组件之间缺乏事务管理机制 | 全局 | 🔴 严重 |
| A-02 | 缺乏统一的任务调度和管理系统 | 全局 | 🔴 严重 |
| A-03 | 业务逻辑硬编码在组件中，无法通过命令行/API调用 | 全局 | 🔴 严重 |
| A-04 | 组件间依赖关系不清晰，未完全解耦 | 维护性 | 🟡 中等 |
| A-05 | 缺乏统一的组件生命周期管理 | 稳定性 | 🟡 中等 |
| A-06 | 事件系统能力不足，无法满足复杂业务需求 | 扩展性 | 🟡 中等 |

**需要思考的问题**：
- [ ] 是否需要引入"服务注册/发现"机制？
- [ ] 任务管理系统应该具备哪些能力？（优先级、依赖、超时、重试）
- [ ] 事务管理是否需要支持回滚？
- [ ] 组件间通信采用什么模式？（事件总线、消息队列、RPC）
- [ ] 如何定义组件的标准接口？

#### 来自 Tom 的回答
服务注册、发现机制是有必要的；
任务管理系统应该作为实际业务的配置替代编程的核心；
我们需要构建几乎面向配置而不是面向代码的嵌入式定义系统，这是 TianshanOS 能够称之为系统的原因。
所以，我们需要一个强大稳定的内核和服务机制来构建整个系统底层。尽量利用S3和P4充足的硬件能力

---

### 3. 用户交互问题 🟡 中等

| 问题编号 | 问题描述 | 影响范围 | 严重程度 |
|---------|---------|---------|---------|
| U-01 | WebUI 仅能读取信息，控制能力弱 | 用户体验 | 🟡 中等 |
| U-02 | 控制台未充分利用 ESP-IDF 官方组件能力 | 稳定性 | 🟡 中等 |
| U-03 | 自行实现的控制台部分稳定性不佳 | 稳定性 | 🟡 中等 |
| U-04 | 命令行帮助系统残缺不完整 | 用户体验 | 🟡 中等 |
| U-05 | 命令格式和语义特征不统一 | 易用性 | 🟡 中等 |
| U-06 | 缺乏命令执行的反馈和进度指示 | 用户体验 | 🟢 轻微 |

**需要思考的问题**：
- [ ] 是否直接采用 ESP-IDF 的 `esp_console` 组件？
- [ ] 命令格式规范如何定义？（子命令风格 vs 参数风格）
- [ ] WebUI 和 CLI 如何共享同一套命令/操作逻辑？
- [ ] 是否需要支持命令脚本/批处理？
- [ ] 帮助系统是否需要多语言支持？

#### 来自 Tom 的回答
采用IDF的esp_console为基础，尽量利用已经在此基础上开发的各种组件实现良好的命令行交互。
参数风格会更好一些，虽然子命令看上去更友好，但是注册的命令数量多了之后还是会导致大量问题。
webUI 和 CLI 其实都只是 UI ，对应同一套 Core API
需要支持简单的脚本和批处理能力，以及一定的自定义命令。
帮助系统和CLI界面，需要支持多语言切换

---

### 4. 安全功能缺失 🔴 严重

| 问题编号 | 问题描述 | 影响范围 | 严重程度 |
|---------|---------|---------|---------|
| S-01 | 未实现 SSH 服务端功能 | 远程管理 | 🔴 严重 |
| S-02 | 缺乏密钥生成和管理能力 | 安全性 | 🔴 严重 |
| S-03 | 未实现 mTLS 双向认证 | 安全通信 | 🔴 严重 |
| S-04 | 缺乏用户认证和权限管理 | 安全性 | 🟡 中等 |
| S-05 | 通信加密能力不完善 | 安全性 | 🟡 中等 |
| S-06 | 固件安全启动未实现 | 安全性 | 🟢 轻微 |

**需要思考的问题**：
- [ ] 嵌入式环境下 SSH 实现的可行性和资源消耗？
- [ ] 密钥存储方案？（NVS 加密分区、外部安全芯片）
- [ ] 是否需要支持证书链验证？
- [ ] 用户权限分级如何设计？（管理员、操作员、只读）
- [ ] 是否需要审计日志？

#### 来自 Tom 的回答
主要是为了在嵌入式环境下实现SSH客户端，而非服务端。
希望能够在ESP32上生成密钥对，私钥存储于硬件加密区中，这个将作为系统的最高权限私钥。公钥则可以从TF卡拷贝到需要的地方。
SSH可以利用私钥登录到指定的主机执行命令。
可执行的命令列表可以通过TF读取
这样要的安全系统应该有什么样的配备你可以根据需要考虑
mTLS 我希望能够用来给浏览器访问webUI的时候作为认证，毕竟执行权限很高，需要我们仔细对待。你需要评估这个思路的可行性。
由于我们会给esp32配置以太网接口，所以我希望能够在内网中除了状态信息可以明文通讯之外，其他的命令和数据都要实现加密传输。

---

### 5. LED 系统问题 🟡 中等

| 问题编号 | 问题描述 | 影响范围 | 严重程度 |
|---------|---------|---------|---------|
| L-01 | LED 命令不稳定 | 稳定性 | 🟡 中等 |
| L-02 | 缺乏表现力，不方便被其他业务调用指示状态 | 易用性 | 🟡 中等 |
| L-03 | 图像格式仅支持 JSON，不支持 PNG/JPG/SVG/BMP/GIF | 功能性 | 🟡 中等 |
| L-04 | 动态效果无法叠加 | 功能性 | 🟡 中等 |
| L-05 | 动画无法保存为文档/导入动画文件 | 功能性 | 🟡 中等 |
| L-06 | 三个 LED 子系统接口不统一 | 一致性 | 🟢 轻微 |
| L-07 | RMT 资源竞争问题 | 稳定性 | 🟡 中等 |

**需要思考的问题**：
- [ ] LED 系统的核心抽象是什么？（像素缓冲区、图层、动画引擎）
- [ ] 是否需要引入"图层"概念实现效果叠加？
- [ ] 图像解码库的选择？（资源占用 vs 格式支持）
- [ ] 动画定义格式如何设计？（JSON、二进制、脚本）
- [ ] 如何设计统一的状态指示 API？

#### 来自 Tom 的回答
LED 需要分成三部分来看：蓝宝石触摸灯、主板环板灯、矩阵灯，都是使用ws2812
矩阵部分主要就是希望能够实现，图片加载、动画、特效，可以同时叠加出现，也可以单独出现。图层的思路比较好，相对来说实现也容易参考，算力要求也不高。
其他两个部分也有大量其他人的实现参考，比如闪烁、呼吸、火焰、水波等等各种灯效。
不管是什么格式，能够导出、导入这些图像、特效、动画即可。
状态指示这个部分需要根据设备读取回来的信息进行绑定。可以做一层抽象，这样的话可能会更好操作。
你也可以进一步细化思考

---

### 6. 业务流程问题 🟡 中等

| 问题编号 | 问题描述 | 影响范围 | 严重程度 |
|---------|---------|---------|---------|
| B-01 | 业务启动顺序无法灵活调整 | 部署灵活性 | 🟡 中等 |
| B-02 | 执行顺序硬编码 | 维护性 | 🟡 中等 |
| B-03 | 缺乏启动依赖关系定义 | 稳定性 | 🟡 中等 |
| B-04 | 无法实现条件启动（如：仅在特定硬件配置下启动某组件） | 灵活性 | 🟢 轻微 |
| B-05 | 缺乏服务健康检查机制 | 可靠性 | 🟡 中等 |

**需要思考的问题**：
- [ ] 是否需要类似 systemd 的服务管理机制？
- [ ] 启动依赖如何定义？（声明式 vs 编程式）
- [ ] 是否支持服务的动态启停？
- [ ] 启动失败如何处理？（重试、降级、告警）

#### 来自 Tom 的回答
其实根据上述其他模块，这个部分不是选项，而是如何实施的方案。

---

### 7. 功能完善度问题 🟡 中等

| 问题编号 | 问题描述 | 影响范围 | 严重程度 |
|---------|---------|---------|---------|
| F-01 | 风扇转速读取功能缺失 | 监控能力 | 🟡 中等 |
| F-02 | 系统监控组件待开发 | 监控能力 | 🟡 中等 |
| F-03 | 自动温度模式未完整实现 | 功能性 | 🟡 中等 |
| F-04 | 文本渲染功能待完善 | 显示能力 | 🟢 轻微 |
| F-05 | OTA 升级功能未提及 | 运维能力 | 🟡 中等 |

#### 来自 Tom 的回答
其他未实现的功能，只要整个系统可以定义，组件解偶、事务管理完备、任务机制可自定义，那么这些问题都可以在本次重构中完善。
OTA是需要考虑的，最好通过ESP32的USB口升级，这个比较稳妥，也可以考虑通过以太网接口获取最新的固件。

---

## 📋 第二部分：深度思考问题清单

### 🏗️ 架构设计层面

#### 1. 平台抽象策略
```
问题：如何设计一个真正可移植的系统架构？

选项 A：编译时平台选择
  - 优点：运行时开销小，代码路径清晰
  - 缺点：需要为每个平台编译不同固件
  
选项 B：运行时硬件检测 + 配置文件
  - 优点：单一固件支持多平台
  - 缺点：运行时开销，配置复杂度高
  
选项 C：混合方案（编译时确定芯片类型，运行时加载引脚配置）
  - 可能是最佳平衡点？

需要决策：_______________________
看上去C是个好选项，也比较符合实际，但是开发阶段一定要保证兼容的问题，否则我们暂时基于s3开发了，后面移植到p4的时候就发现需要全部重写或者独立分支那就麻烦了。
```

#### 2. 引脚配置管理
```
问题：引脚配置如何管理？

层次设计：
  ┌─────────────────────────────────────┐
  │  应用层（逻辑功能：FAN_PWM, LED_DATA） │
  ├─────────────────────────────────────┤
  │  映射层（逻辑功能 → 物理引脚）         │
  ├─────────────────────────────────────┤
  │  硬件层（GPIO 实际操作）              │
  └─────────────────────────────────────┘

配置来源选项：
  A. 代码内硬编码（当前方式，不推荐）
  B. 头文件定义（编译时确定）
  C. Kconfig 菜单配置
  D. NVS 存储（运行时可修改）
  E. 外部配置文件（SD卡/SPIFFS）
  F. 组合方案（默认值 + 可覆盖配置）

需要决策：_______________________
D+E+F

```

#### 3. 组件通信机制
```
问题：组件间如何通信？

选项对比：
┌────────────────┬─────────────┬─────────────┬─────────────┐
│     机制       │   耦合度    │    性能     │   复杂度    │
├────────────────┼─────────────┼─────────────┼─────────────┤
│ 直接函数调用   │    高       │    最高     │    低       │
│ 事件总线       │    低       │    中       │    中       │
│ 消息队列       │    低       │    中       │    中高     │
│ 发布/订阅      │    最低     │    中       │    中       │
│ 共享状态+锁    │    中       │    高       │    中       │
└────────────────┴─────────────┴─────────────┴─────────────┘

当前系统使用：事件管理器（event_manager）
问题：是否足够？需要增强哪些能力？

需要决策：_______________________
根据第一部分的实际需求你给出建议吧，我比较倾向于耦合度低的方式处理。
```

#### 4. 任务/服务管理系统
```
问题：是否需要一个中央任务管理器？

需要支持的能力：
  □ 服务注册和发现
  □ 启动顺序和依赖管理
  □ 服务状态监控
  □ 健康检查
  □ 故障恢复（自动重启）
  □ 资源限制
  □ 优先级调度
  □ 动态启停

复杂度 vs 收益的平衡点在哪里？

需要决策：_______________________
显然作为一个系统，这个可能是关键部分

```

---

### 💻 用户交互层面

#### 5. 控制台设计
```
问题：控制台系统如何设计？

ESP-IDF 官方组件能力：
  - esp_console：命令注册、参数解析、自动补全、历史记录
  - argtable3：参数定义和验证
  - linenoise：行编辑功能

设计选项：
  A. 完全基于 esp_console 重写
  B. 保留现有框架，集成 esp_console 能力
  C. 自定义框架但借鉴 esp_console 设计

命令格式规范需要统一：
  当前混乱示例：
    - fan set 0 75          （位置参数）
    - led touch set red     （多级子命令）
    - net config set ip ... （更深的子命令）
    - gpio 42 high          （位置参数）

  建议的统一风格：
    <domain> <action> [target] [options]
    例：fan set --id 0 --speed 75
    例：led set --type touch --color red
    例：net config --ip 10.10.99.97

需要决策：_______________________
我希望完全基于 esp_console 重写，采用参数风格
```

#### 6. WebUI 与 CLI 的关系
```
问题：WebUI 和 CLI 如何协同？

架构选项：

  选项 A：WebUI 调用 CLI 命令
    ┌─────────┐     ┌─────────┐     ┌─────────┐
    │  WebUI  │ ──▶ │   CLI   │ ──▶ │ 业务层  │
    └─────────┘     └─────────┘     └─────────┘
    优点：复用 CLI 逻辑
    缺点：解析开销，错误处理复杂

  选项 B：共享 API 层
    ┌─────────┐     ┌─────────┐
    │  WebUI  │ ──┐ │         │
    └─────────┘   ├▶│  API    │ ──▶ 业务层
    ┌─────────┐   │ │         │
    │   CLI   │ ──┘ └─────────┘
    └─────────┘
    优点：接口统一，维护方便
    缺点：需要设计良好的 API 层

  选项 C：独立实现
    各自调用业务层
    优点：灵活
    缺点：代码重复，行为可能不一致

需要决策：_______________________
我希望采用B方案，webUI 和 CLI UI 调用统一的 Core API
```

---

### 🔐 安全层面

#### 7. SSH 实现策略
```
问题：嵌入式环境下如何实现 SSH？

可选方案：
  A. wolfSSH（轻量级，专为嵌入式设计）
     - 内存占用：~50KB
     - 功能：SSH2 客户端/服务端
  
  B. Dropbear（更小，但功能有限）
     - 内存占用：~30KB
     - 需要移植
  
  C. 自定义简化协议（非标准 SSH）
     - 安全性存疑
     - 不推荐

  D. 放弃 SSH，使用 TLS + 自定义协议
     - 可以复用 mbedTLS（ESP-IDF 内置）
     - 需要自定义客户端

需要决策：_______________________
这个不是倾向选项，根据第一部分描述的需要进行评估
```

#### 8. 密钥和证书管理
```
问题：密钥如何生成、存储、管理？

存储选项：
  A. NVS 加密分区
     - ESP-IDF 原生支持
     - 依赖 flash 加密
  
  B. 外部安全芯片（如 ATECC608）
     - 更高安全性
     - 需要额外硬件
  
  C. 软件模拟的安全存储
     - 成本低
     - 安全性有限

密钥类型需求：
  □ 设备身份密钥（长期）
  □ 会话密钥（临时）
  □ mTLS 证书
  □ 用户认证凭据

需要决策：_______________________
暂时没有外部安全芯片，可以预留扩展能力，当前IO口不够无法实现，后续可以考虑。
密钥生成可以参考IDF的相关内容，符合我们业务的需要，在现有条件下实现分级安全。
```

---

### 🎨 LED 系统层面

#### 9. LED 架构重设计
```
问题：LED 系统如何重新设计？

建议的分层架构：
  ┌─────────────────────────────────────┐
  │           应用层 API                │
  │  (状态指示、动画播放、图像显示)      │
  ├─────────────────────────────────────┤
  │           图层管理器                │
  │  (多图层叠加、透明度、混合模式)      │
  ├─────────────────────────────────────┤
  │           动画引擎                  │
  │  (关键帧、缓动函数、动画队列)        │
  ├─────────────────────────────────────┤
  │           渲染器                    │
  │  (像素缓冲区、颜色空间转换)          │
  ├─────────────────────────────────────┤
  │           驱动抽象层                │
  │  (WS2812、APA102、通用 LED 条)      │
  └─────────────────────────────────────┘

关键设计决策：
  □ 是否引入图层概念？
  □ 动画定义格式？
  □ 状态指示 API 设计？
  □ 图像格式支持范围？

需要决策：_______________________
图层、动画、特效都是需要考虑的
状态指示API我们需要留好接口，根据命令行或webui的配置来处理
```

#### 10. 图像格式支持
```
问题：支持哪些图像格式？如何解码？

格式分析：
┌────────┬───────────┬───────────┬────────────┐
│  格式  │  复杂度   │ 内存占用  │   库支持   │
├────────┼───────────┼───────────┼────────────┤
│  BMP   │   简单    │    低     │  可手写    │
│  PNG   │   中等    │    中     │  libpng    │
│  JPG   │   复杂    │    高     │  libjpeg   │
│  GIF   │   中等    │    中     │  gifdec    │
│  SVG   │   复杂    │    高     │  需要解析  │
└────────┴───────────┴───────────┴────────────┘

建议优先级：
  1. BMP（简单，必须支持）
  2. PNG（常用，推荐支持）
  3. GIF（动画，推荐支持）
  4. JPG（可选）
  5. SVG（暂不支持，复杂度高）

需要决策：_______________________
你的必须和推荐我都认可，jpg如果可以调用库就能实现也可以。SVG就暂时不考虑吧，以后再说。
```

---

### 📊 系统管理层面

#### 11. 启动和服务管理
```
问题：如何管理服务启动顺序和生命周期？

设计选项：

  A. 简单优先级队列
     - 每个服务定义优先级
     - 按优先级顺序启动
     - 简单但不灵活

  B. 依赖图
     - 定义服务间依赖关系
     - 拓扑排序确定启动顺序
     - 支持并行启动无依赖服务

  C. 阶段化启动
     - 定义启动阶段（硬件、核心、应用）
     - 每阶段内并行启动
     - 平衡复杂度和灵活性

服务定义示例（选项 B）：
  {
    "name": "fan_controller",
    "depends_on": ["hardware_hal", "config_manager"],
    "optional_depends": ["agx_monitor"],
    "auto_start": true,
    "restart_policy": "on_failure"
  }

需要决策：_______________________
嵌入式硬件依赖图可能更稳定，有没有可能整体使用阶段化启动、具体阶段中引入依赖图。
```

#### 12. 配置管理增强
```
问题：配置系统需要哪些增强？

当前能力：
  ✓ NVS 键值存储
  ✓ 多数据类型
  ✓ 命名空间隔离

需要增强：
  □ 配置版本控制和迁移
  □ 配置导入/导出（完整备份）
  □ 配置验证（schema）
  □ 默认值管理
  □ 配置变更通知
  □ 多配置文件（dev/prod）

配置来源优先级：
  1. 命令行参数（最高）
  2. 环境变量
  3. 用户配置（NVS）
  4. 默认值（代码内）

需要决策：_______________________
你现在考虑到的似乎都有必要，而且根据前面的内容，是不是还有其他能力需要增强。同时要考虑，哪些是临时配置，哪些是持久化配置。哪些需要依赖外部储存，哪些是通过外部存储载入后变为内部保存。这些细节也需要在开发时完善。
```

---

## 📋 第三部分：技术选型待决策

### 核心技术选型

| 领域 | 选项 | 状态 |
|-----|------|------|
| **控制台框架** | esp_console / 自定义 / 混合 | ⏳ 待决策 |
| **命令解析** | argtable3 / 自定义 / getopt | ⏳ 待决策 |
| **事件系统** | esp_event / 自定义增强 | ⏳ 待决策 |
| **HTTP服务器** | esp_http_server / mongoose | ⏳ 待决策 |
| **JSON解析** | cJSON / 自定义 | ✅ cJSON（已使用） |
| **SSH实现** | wolfSSH / dropbear / 无 | ⏳ 待决策 |
| **TLS** | mbedTLS（ESP-IDF内置） | ✅ 确定 |
| **图像解码** | stb_image / libpng / 手写BMP | ⏳ 待决策 |
| **文件系统** | FAT32 / LittleFS / SPIFFS | ⏳ 待决策 |

除了文件系统之外，我们前面都已经讨论过了，文件系统涉及到TF的话，就采用FAT32，内部存储你根据实际需要考虑。
---

## 📋 第四部分：开发阶段规划草案

### 阶段概览

```
Phase 0: 规划与设计（当前阶段）
    ↓
Phase 1: 基础架构重构
    ↓
Phase 2: 核心组件重写
    ↓
Phase 3: 硬件控制组件
    ↓
Phase 4: LED 系统重构
    ↓
Phase 5: 网络与安全
    ↓
Phase 6: 用户交互优化
    ↓
Phase 7: 集成测试与优化
```

### Phase 0: 规划与设计（1-2周）

**目标**：完成所有设计决策，输出详细的设计文档

- [ ] 完成架构设计文档
- [ ] 完成引脚配置方案设计
- [ ] 完成命令规范设计
- [ ] 完成 API 设计规范
- [ ] 完成服务管理机制设计
- [ ] 技术选型最终确定
- [ ] 制定详细的开发计划和里程碑

**交付物**：
- 架构设计文档
- API 设计文档
- 命令规范文档
- 开发计划文档

---

### Phase 1: 基础架构重构

**目标**：建立新的基础架构，为后续组件开发奠定基础

#### 1.1 项目结构重组
```
TianShanOS/
├── components/                 # 组件目录
│   ├── ts_core/               # 核心框架
│   │   ├── ts_config/         # 配置管理
│   │   ├── ts_event/          # 事件系统
│   │   ├── ts_service/        # 服务管理
│   │   └── ts_log/            # 日志系统
│   ├── ts_hal/                # 硬件抽象层
│   │   ├── ts_gpio/           # GPIO 抽象
│   │   ├── ts_pwm/            # PWM 抽象
│   │   ├── ts_spi/            # SPI 抽象
│   │   └── ts_uart/           # UART 抽象
│   ├── ts_console/            # 控制台系统
│   ├── ts_led/                # LED 系统
│   ├── ts_net/                # 网络系统
│   ├── ts_security/           # 安全模块
│   └── ts_drivers/            # 设备驱动
│       ├── fan/
│       ├── power/
│       └── storage/
├── boards/                    # 板级配置
│   ├── rm01_esp32s3/          # RM01 ESP32S3 配置
│   └── rm01_esp32p4/          # RM01 ESP32P4 配置（预留）
├── main/
├── docs/
└── tests/
```

#### 1.2 核心模块开发优先级
1. **ts_config** - 配置管理（最基础）
2. **ts_log** - 日志系统
3. **ts_event** - 事件系统
4. **ts_service** - 服务管理
5. **ts_hal** - 硬件抽象层

---

### Phase 2-7: 待详细规划

*根据 Phase 0 的决策结果，详细规划后续阶段*

---

## 📋 第五部分：待讨论问题

### 需要您决策的关键问题

1. **硬件平台支持范围**
   - 是否确定支持 ESP32S3 和 ESP32P4？是的
   - 是否需要考虑其他平台？不考虑

2. **引脚配置方式**
   - 编译时确定 vs 运行时配置？
   - 您倾向于哪种方式？运行时

3. **命令格式规范**
   - 您对命令格式有什么偏好？参数风格
   - 是否需要向后兼容现有命令？不考虑

4. **SSH 优先级**
   - SSH 是必须功能还是可选功能？SSH客户端必选功能
   - 是否可以用其他方案（如 TLS WebSocket）替代？你需要评估操作算力SoM和应用SoM的风险

5. **LED 图像格式优先级**
   - 哪些格式是必须支持的？上面讨论过了PNG、JPG、BMP、GIF
   - GIF 动画支持的优先级？高

6. **WebUI 功能范围**
   - WebUI 需要达到什么程度的控制能力？能够控制CoreAPI的所有接口
   - 是否需要与 CLI 完全等价？在认证用户权限后可以完全等价，否则只能查看一些状态信息。

7. **开发资源和时间**
   - 预计的开发周期？
   - 可投入的开发资源？

8. **兼容性要求**
   - 是否需要兼容现有的 robOS 配置？不需要兼容
   - 是否需要迁移工具？不需要迁移工具

---

## 📝 下一步行动

1. **完成待决策问题的讨论**
2. **确定技术选型**
3. **输出详细的架构设计文档**
4. **制定分阶段的详细开发计划**
5. **建立项目开发规范**

---

**文档版本**：1.0  
**状态**：讨论中  
**下次更新**：根据讨论结果更新决策

